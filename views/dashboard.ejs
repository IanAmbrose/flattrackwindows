<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard</title>
  </head>
  <body>
    <h1>Welcome <%= username %>!</h1>
    <% if (userGroups && userGroups.length > 0) { %>
      <h2>Your Groups:</h2>
      <ul>
        <% userGroups.forEach(group => { %>
          <li>
            <%= group.name %>
            <form method="POST" action="/dashboard/leave-group/<%= group._id %>">
              <button type="submit" onclick="return confirmLeaveGroup('<%= group.name %>')">x</button>
            </form>
          </li>
        <% }); %>
      </ul>
    <% } else { %>
      <p>You are not a member of any groups yet.</p>
    <% } %>
    <hr>
    <% if (!inGroup) { %>
      <h2>Group Management:</h2>
      <h3>Create a new group:</h3>
      <% if (messages && messages.error) { %>
        <p style="color: red;"><%= messages.error %></p>
      <% } else if (messages && messages.success) { %>
        <p style="color: green;"><%= messages.success %></p>
      <% } %>
      <form method="POST" action="/create-group">
        <label for="groupName">Group Name:</label>
        <input type="text" id="groupName" name="groupName" required>
        <button type="submit">Create Group</button>
      </form>
      <hr>
      <h3>Join an existing group:</h3>
      <% if (messages && messages.error) { %>
        <p style="color: red;"><%= messages.error %></p>
      <% } else if (messages && messages.success) { %>
        <p style="color: green;"><%= messages.success %></p>
      <% } %>
      <form method="POST" action="/join-group">
        <label for="groupCode">Group Code:</label>
        <input type="text" id="groupCode" name="groupCode" required>
        <button type="submit">Join Group</button>
      </form>
    <% } %>
    <hr>
    <h3>Your Account:</h3>
    <p>
      <form action="/logout" method="post" style="display: inline;">
        <button type="submit" class="btn btn-link" style="padding: 0; text-decoration: none;">Logout</button>
      </form>
    </p>
    <script>
      function confirmLeaveGroup(groupName) {
        return confirm('Are you sure you want to leave "' + groupName + '"?');
      }
    </script>
  </body>
</html>
